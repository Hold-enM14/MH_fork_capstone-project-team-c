---
title: "Untitled"
output: html_document
date: "2025-11-19"
---

libraries
```{r}
library(dplyr)
library(psych)
library(knitr)
library(tidyr)
library(ggplot2)
```

Importing data
```{r}
final_data = read.csv("data/merged_marathon_data.csv")
```

Tables and Graphing: 

```{r}
# Table 1: Continuous Variable Summary
# Select the continuous variables
continuous_summary <- final_data %>%
  select(avg_chip_seconds, high_temp, low_temp, avg_temp, precipitation,
         dew_point, wind_speed, visibility, sea_level_pressure, aqi, pm10, pm25, no2, ozone, co) %>%
  summarise_all(list(
    mean = ~mean(., na.rm = TRUE),
    median = ~median(., na.rm = TRUE),
    sd = ~sd(., na.rm = TRUE),
    min = ~min(., na.rm = TRUE),
    max = ~max(., na.rm = TRUE)
  ))
continuous_summary
```


```{r}
# Table 2: Continuous variables summarized by subgroup and gender
# Select continuous variables
continuous_summary_grouped <- final_data %>%
  group_by(gender, subgroup) %>% # group by gender and subgroup
  summarise(
    avg_chip_seconds_mean = mean(avg_chip_seconds, na.rm = TRUE),
    avg_chip_seconds_sd = sd(avg_chip_seconds, na.rm = TRUE),
    high_temp_mean = mean(high_temp, na.rm = TRUE),
    high_temp_sd = sd(high_temp, na.rm = TRUE),
    low_temp_mean = mean(low_temp, na.rm = TRUE),
    low_temp_sd = sd(low_temp, na.rm = TRUE),
    avg_temp_mean = mean(avg_temp, na.rm = TRUE),
    avg_temp_sd = sd(avg_temp, na.rm = TRUE),
    precipitation_mean = mean(precipitation, na.rm = TRUE),
    precipitation_sd = sd(precipitation, na.rm = TRUE),
    dew_point_mean = mean(dew_point, na.rm = TRUE),
    dew_point_sd = sd(dew_point, na.rm = TRUE),
    wind_speed_mean = mean(wind_speed, na.rm = TRUE),
    wind_speed_sd = sd(wind_speed, na.rm = TRUE),
    visibility_mean = mean(visibility, na.rm = TRUE),
    visibility_sd = sd(visibility, na.rm = TRUE),
    sea_level_pressure_mean = mean(sea_level_pressure, na.rm = TRUE),
    sea_level_pressure_sd = sd(sea_level_pressure, na.rm = TRUE),
    aqi_mean = mean(aqi, na.rm = TRUE),
    aqi_sd = sd(aqi, na.rm = TRUE),
    pm10_mean = mean(pm10, na.rm = TRUE),
    pm10_sd = sd(pm10, na.rm = TRUE),
    pm25_mean = mean(pm25, na.rm = TRUE),
    pm25_sd = sd(pm25, na.rm = TRUE),
    no2_mean = mean(no2, na.rm = TRUE),
    no2_sd = sd(no2, na.rm = TRUE),
    ozone_mean = mean(ozone, na.rm = TRUE),
    ozone_sd = sd(ozone, na.rm = TRUE),
    co_mean = mean(co, na.rm = TRUE),
    co_sd = sd(co, na.rm = TRUE)
  ) %>%
  arrange(gender, subgroup)
continuous_summary_grouped
```


```{r}
# Figure 1: Distribution of Average Finishing Times
library(ggplot2) # load plotting library
ggplot(final_data, aes(x = avg_chip_seconds / 3600)) + # convert from seconds to hours
  geom_histogram(bins = 20, fill = "steelblue", color = "black") + # create a histogram
  labs(title = "Distribution of Average Finishing Times", # generate labels
    x = "Average Finishing Time (hours)",
    y = "Frequency"
  )
```



```{r}
# Figure 2: Overview of the Effect of Avg Temperature on Finishing Time by Marathon
ggplot(final_data, aes(x = avg_temp, y = avg_chip_seconds / 3600, color = marathon)) +
  geom_point(alpha = 0.6) +
  geom_smooth(method = "lm", se = FALSE, color = "black") +
  facet_wrap(~ marathon, scales = "free_x") + # each marathon has own x-axis scale
  labs(title = "Overview of the Effect of Average Temperature on Finishing Time by Marathon",
    x = "Average Temperature (Â°F)",
    y = "Finishing Time (hours)"
  )
```



```{r}
# Figure 3: Overview of the Relationship Between Air Quality and Finishing Time by Marathon
ggplot(final_data, aes(x = aqi, y = avg_chip_seconds / 3600, color = marathon)) +
  geom_point(alpha = 0.6) +
  geom_smooth(method = "lm", se = FALSE, color = "black") +
  facet_wrap(~ marathon, scales = "free_x") + 
  labs(title = "Overview of the Relationship Between Air Quality and Finishing Time by Marathon",
    x = "Air Quality Index (AQI)",
    y = "Average Finishing Time (hours)"
  ) +
  theme(legend.position = "none")
```



```{r}
# select only the numeric variables
numeric_vars <- final_data %>%
  select(avg_chip_seconds, avg_temp, precipitation, dew_point,
         wind_speed, visibility, sea_level_pressure,
         aqi, pm10, pm25, no2, ozone, co)

# create correlation matrix
cor_matrix <- cor(numeric_vars, use = "complete.obs")

# round the correlations
round(cor_matrix, 2)
```


Table for continuous variables:
```{r}
# Select continuous variables
continuous_vars <- final_data %>% 
  select(
    avg_chip_seconds,
    high_temp,
    low_temp,
    avg_temp,
    dew_point,
    wind_speed,
    visibility,
    sea_level_pressure,
    aqi,
    co,
    ozone,
    pm10,
    pm25,
    no2
  )


str(continuous_vars)
```


```{r}
continuous_only <- continuous_vars %>%
  select(where(is.numeric))

continuous_summary <- describe(continuous_only) %>%
  as.data.frame() %>%
  select(
    mean,
    sd,
    median,
    min,
    max,
    skew,
    kurtosis,
    n
  )
continuous_summary

```


```{r}
summary_table <- tribble(
  ~variable, ~mean, ~sd, ~median, ~min, ~max, ~skew, ~kurtosis, ~n,
  "avg_chip_seconds", 15631.620549, 2938.8848538, 15284.20, 10304.77, 23679.03, 0.50530121, -0.3896989, 1005,
  "high_temp",        61.621891,   10.4803135, 61.00, 44.00, 88.00, 0.57757331, -0.3573111, 1005,
  "low_temp",         46.009950,    7.9703072, 45.00, 28.00, 72.00, 0.77231953,  1.0186755, 1005,
  "avg_temp",         53.718209,    8.6975811, 52.88, 29.58, 79.35, 0.42260873,  0.3116392, 1005,
  "dew_point",        41.023831,   10.7187978, 42.40, 21.13, 65.22, -0.08246867, -0.9095537, 1005,
  "wind_speed",       13.119403,    6.7699588, 13.00,  3.00, 39.00, 0.78517635,  1.0872273, 1005,
  "visibility",        9.848072,    1.4872173, 10.00,  6.06, 20.00, 2.79083334, 25.7005389, 830,
  "sea_level_pressure", 29.925970, 0.3391476, 29.98, 29.13, 30.54, -0.41101449, -0.7527869, 1005,
  "aqi",              50.572139,   21.7623899, 52.00, 11.00, 119.00, 0.32111228, 0.2198760, 1005,
  "co",               13.948052,   11.7791733,  9.00,  2.00,  56.00, 1.58769285, 2.1592651, 770,
  "ozone",            36.179104,   18.0530913, 34.00,  7.00, 100.00, 1.22285653, 2.3430336, 1005,
  "pm10",             23.576000,   13.0305755, 21.00,  5.00,  69.00, 0.89184403, 0.8083714, 625,
  "pm25",             57.510345,   16.7892845, 53.00, 21.00, 119.00, 0.85098957, 1.3911927, 725,
  "no2",              31.915423,   14.9253725, 32.00,  7.00,  66.00, 0.15839726, -0.7783209, 1005
)

kable(summary_table, caption = "Table: Descriptive Statistics for Continuous Variables", digits = 2)

```

```{r}
# Make pollutant data into log format for graphing
pollutant_long <- final_data %>%
  mutate(
    finish_hours = avg_chip_seconds / 3600   # convert seconds to hours
  ) %>%
  pivot_longer(
    cols = c(co, pm25, pm10, aqi),
    names_to = "pollutant",
    values_to = "value"
  )

# plotting scatter plots
ggplot(pollutant_long, 
       aes(x = value, y = finish_hours, color = pollutant)) +
  geom_point(alpha = 0.25) +
  geom_smooth(se = FALSE, method = "loess") +
  facet_wrap(~ subgroup, scales = "free") +
  scale_color_brewer(palette = "Dark2") +
  labs(
    title = "Pollution vs. Finish Times by Performance Subgroup",
    x = "Pollutant Level (AQI)",
    y = "Average Finishing Time (hours)",
    color = "Pollutant"
  ) +
  theme_minimal(base_size = 14)

```